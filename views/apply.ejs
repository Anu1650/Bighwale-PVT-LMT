<%- include('partials/header') %>
<div class="container py-5">
  <div class="card shadow-lg p-4 animate__animated animate__fadeIn">
    <h2 class="text-center text-primary mb-4">Apply for a Position</h2>
    <form action="/apply" method="POST" enctype="multipart/form-data" class="row g-3" id="applyForm">
      
      <div class="col-md-6">
        <label class="form-label fw-bold">Full Name</label>
        <input type="text" name="name" class="form-control" placeholder="Enter your full name" required>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-bold">Email</label>
        <input type="email" name="email" class="form-control" placeholder="you@example.com" required>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-bold">Phone</label>
        <input type="tel" name="phone" class="form-control" placeholder="Your phone number" 
               pattern="[0-9]{10,}" minlength="10" maxlength="15" required>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-bold">WhatsApp</label>
        <input type="tel" name="whatsapp" class="form-control" placeholder="Your WhatsApp number" 
               pattern="[0-9]{10,}" minlength="10" maxlength="15" required>
      </div>

      <div class="col-md-12">
        <label class="form-label fw-bold">Education</label>
        <input type="text" name="education" class="form-control" placeholder="Your highest qualification" required>
      </div>

      <!-- Resume upload (Optional) -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Resume (PDF or Image) - Optional</label>
        <input type="file" name="resume" id="resumeInput" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
      </div>

      <!-- Experience textarea (Optional) -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Experience - Optional</label>
        <textarea name="experience" id="experienceField" class="form-control" rows="3" placeholder="No Experience"></textarea>
      </div>

      <div class="col-12 text-center">
        <button type="submit" class="btn btn-primary px-4 btn-lg">Submit Application</button>
      </div>
    </form>
  </div>
</div>

<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  const form = document.getElementById('applyForm');
  const resumeInput = document.getElementById('resumeInput');
  const experienceField = document.getElementById('experienceField');

  form.addEventListener('submit', function(e) {
    const phone = form.phone.value.trim();
    const whatsapp = form.whatsapp.value.trim();
    const experienceText = experienceField.value.trim();

    // Validate phone numbers length
    if (phone.length < 10 || whatsapp.length < 10) {
      e.preventDefault();
      Swal.fire({
        icon: 'error',
        title: 'Invalid Number',
        text: 'Phone and WhatsApp numbers must be at least 10 digits long.',
        confirmButtonColor: '#d33'
      });
      return;
    }

    // Auto-fill "No Experience" if blank
    if (experienceText === "") {
      experienceField.value = "No Experience";
    }
  });
</script>

<script>
  <% if (typeof messages !== 'undefined') { %>
    <% if (messages.error && messages.error.length > 0) { %>
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: <%- JSON.stringify(messages.error[0]) %>,
        confirmButtonColor: '#d33',
        showClass: { popup: 'animate__animated animate__shakeX' },
        hideClass: { popup: 'animate__animated animate__fadeOut' }
      });
    <% } %>
    <% if (messages.success && messages.success.length > 0) { %>
      Swal.fire({
        icon: 'success',
        title: 'Application Submitted!',
        text: <%- JSON.stringify(messages.success[0]) %>,
        showConfirmButton: false,
        timer: 2500,
        showClass: { popup: 'animate__animated animate__fadeInDown' },
        hideClass: { popup: 'animate__animated animate__fadeOutUp' },
        didClose: () => {
          window.location.href = "/";
        }
      });
    <% } %>
  <% } %>
</script>

<%- include('partials/footer') %>
